// Filename: rocktimer.full.js  
// Timestamp: 2014/03/01 (last modified)  
// Author(s): Bumblehead (www.bumblehead.com)  

var incrnum=("object"==typeof module?module:{}).exports=function(n,t){return t=function(){return n++},t.toString=function(){return n++},t}(0);var eventhook=("object"==typeof module?module:{}).exports=function(){var n={fnArr:[],addFn:function(n){"function"==typeof n&&(n.oname="fn"+incrnum,this.fnArr.push(n))},rmFn:function(n){var r=n.oname;"function"==typeof n&&(this.fnArr=this.fnArr.filter(function(n){return n.oname!==r}))},fire:function(n,r,t,o){this.fnArr.map(function(e){e(n,r,t,o)})}};return{proto:n,getNew:function(){var r=Object.create(n);return r.fnArr=[],r}}}();var rocktimerms=("object"==typeof module?module:{}).exports=function(t){var e={ms:0,mstotal:0,remaining:null,toString:function(){return this.ms},ashh:function(){return Math.floor(this.ms/36e5)},asmm:function(){return Math.floor(this.ms/6e4)},asss:function(){return Math.floor(this.ms/1e3)}};return t=function(t,r){var n=Object.create(e);return n.ms=t,n.mstotal=r,n.remaining=Object.create(n),n.remaining.ms=r-t,n},t.proto=e,t.getms=function(t){var e=0;return"object"==typeof t&&t&&("number"==typeof t.hh&&(e+=36e5*t.hh),"number"==typeof t.mm&&(e+=6e4*t.mm),"number"==typeof t.ss&&(e+=1e3*t.ss),"number"==typeof t.ms&&(e+=t.ms)),e},t}();var mlcm=("object"==typeof module?module:{}).exports=function(n){function e(n){return n.reduce(function e(n,r){return 0===r?n:e(r,n%r)})}function r(n){return n.reduce(function(n,r){return Math.abs(n*r)/e([n,r])})}return n=r,n.lcm=r,n.gcd=e,n}();var rocktimerframes=("object"==typeof module?module:{}).exports={getPossibleFramesGCD:function(t,r){var e=+r;return t.length&&(e=mlcm.gcd(t.map(function(t){return t.ms}))),e},buildObj:function(t,r,e){var n=this,m={},u=rocktimerms(r,e),i=t.filter(function(t){return 0===r||r%t.ms===0&&r>=t.ms});return i.length&&(m=function(){i.map(function(t){t(n,u)})}),m.msObj=u,m},buildObjArr:function(t,r){for(var e=this,n=e.getPossibleFramesGCD(t,r),m=Math.ceil(r/n),u=-1,i=[];++u<=m;)i.push(e.buildObj(t,n*u,r));return i.ms=r,i.mspf=n,i.framesnum=m,i.callframe=function(t,r){return"function"==typeof(r=this[t])&&r()},i.getframemsObj=function(t,r){return(r=this[t])&&r.msObj},i}};var rocktimer=("object"==typeof module?module:{}).exports=function(t){var r={timer:null,ms:0,getms:rocktimerms.getms,isActive:function(){return null===this.timer?!1:!0},getFrameObjCur:function(){return this.framesArr[this.frameindex]},onStop:function(t){return this.onStopHook.addFn(t),this},onClear:function(t){return this.onClearHook.addFn(t),this},onStart:function(t){return this.onStartHook.addFn(t),this},onExtend:function(t){return this.onExtendHook.addFn(t),this},callStop:function(){this.onStopHook.fire(this,this.getFrameObjCur().msObj)},callClear:function(){this.onClearHook.fire(this,this.getFrameObjCur().msObj)},callStart:function(){this.onStartHook.fire(this,this.getFrameObjCur().msObj)},callExtend:function(){this.onExtendHook.fire(this,this.getFrameObjCur().msObj)},getRemainingms:function(){var t=this,r=t.framesArr,e=r.length-t.frameindex;return e*r.mspf},forEach:function(t,r){var e=this,n=e.getms(t);if("number"!=typeof n)throw new Error("invalid timeopts");if("function"!=typeof r)throw new Error("invalid function");return r.ms=n,e.foreachArr.push(r),e.framesArr=rocktimerframes.buildObjArr(e.foreachArr,e.ms),e},updateFrameState:function(t,r,e){return 1===e&&t>=r.length&&(e=4),e},animate:function(){var t=this;!function r(e,n){switch(n=t.framesArr,t.st=t.updateFrameState(++t.frameindex,n,t.st),t.st){case 1:n.callframe(t.frameindex),t.timer=setTimeout(r,n.mspf);break;case 2:t.st=1;break;case 3:t.st=3,t.clear();break;default:t.st=4,t.frameindex--,t.complete()}}()},clearInterval:function(){var t=this;t.timer&&(clearInterval(t.timer),t.timer=null)},reset:function(){var t=this;return t.clear(),t.start(),t},extend:function(t){var r=this,e=r.ms+r.getms(t);return r.framesArr=rocktimerframes.buildObjArr(r.foreachArr,e),r.ms=e,r.callExtend(),r},complete:function(){var t=this;1===t.st&&(t.st=4,t.clearInterval()),t.callStop()},stop:function(){var t=this;return 1===t.st&&(t.st=2,t.clearInterval(),t.callStop()),t},clear:function(){var t=this;return t.frameindex=0,t.callClear(),1!==t.st&&(t.st=4,t.clearInterval()),t},start:function(){var t=this,r=t.st;return(4===r||2===r)&&(4===r&&(t.bgnDate=new Date,t.frameindex=0),t.callStart(),t.st=1,t.animate()),t},reinit:function(){var t=this;return t.clear(),t.st=4,t.init(),t}};return t=function(t){var e=Object.create(r);return e.onClearHook=eventhook.getNew(),e.onStartHook=eventhook.getNew(),e.onStopHook=eventhook.getNew(),e.onExtendHook=eventhook.getNew(),e.bgnDate=new Date,e.frameindex=0,e.foreachArr=[],e.timer=null,e.ms=e.getms(t)||0,e.st=4,e.framesArr=rocktimerframes.buildObjArr([],e.ms),e},t.proto=r,t}();